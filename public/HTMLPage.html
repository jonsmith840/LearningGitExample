<!DOCTYPE html>

<html lang="en">
    <head>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
      <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
      <link type="text/css" href="/css/teachapp.css" rel="stylesheet">
      <link rel="icon" type="image/png" href="favicon.png" />
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
        <meta charset="utf-8" />
        <title>Oxford Open Learning for Mentors & Supervisors</title>
        <script type="text/javascript">
        var tableHtml = '';
        var selectedCourse = 0;
        function showList(){
          $('#StuffGoesHere').toggle();
          $('#ShowHide').toggle();
        }
        function restoreStudentList(){
          $('#StuffGoesHere').html(tableHtml);
        }
        function showStudent(Code){
          var studentjson = { QueryString : "ContactDetailsAuthIDSP" , Params : {Contact : [Code]}};
          $.ajax({
    				url: './',
    				type: 'post',
    				data: JSON.stringify(studentjson),
    				dataType: 'json',
    				contentType: 'application/json; charset=utf-8',
    				success: function( data ) {
              var address = data[0].Street;
              if (data[0].Locality.length) address += '<br>' + data[0].Locality;
              if (data[0].Town.length) address += '<br>' + data[0].Town;
              if (data[0].County.length) address += '<br>' + data[0].County;
              if (data[0].Country.length) address += '<br>' + data[0].Country;
              if (data[0].Postcode.length) address += '<br>' + data[0].Postcode;
              var studentHtml = '<h2>Student details for ' + data[0].FirstName + ' ' + data[0].LastName + '</h2>';
              studentHtml += '<div class="top-info">';

              studentHtml += '<div class="top-info-left">';
              studentHtml += '<div class="highlighted">';

              studentHtml += '<h4>Full Student Details</h4>';
              studentHtml += '<table class="tbl-top-info">';
              studentHtml += '<tbody>';
              studentHtml += '<tr>';
              studentHtml += '<td>Name:</td>';
              studentHtml += '<td>' + data[0].Title + ' ' + data[0].FirstName + ' ' + data[0].LastName +'</td>';
              studentHtml += '</tr>';
              studentHtml += '<tr>';
              studentHtml += '<td>Address:</td>';
              studentHtml += '<td>' + address + '</td>';
              studentHtml += '</tr>';
              studentHtml += '<tr>';
              studentHtml += '<td>Email:</td>';
              studentHtml += '<td>' + data[0].email + '</td>';
              studentHtml += '</tr>';
              studentHtml += '<tr>';
              studentHtml += '<td>Phone1:</td>';
              studentHtml += '<td>' + data[0].Phone + '</td>';
              studentHtml += '</tr>';
              if (data[0].Work_Phone.length > 6){
                studentHtml += '<tr>';
                studentHtml += '<td>Phone2:</td>';
                studentHtml += '<td>' + data[0].Work_Phone + '</td>';
                studentHtml += '</tr>';
              }
              studentHtml += '</tbody>';
              studentHtml += '</table>';

              studentHtml += '</div>';
              studentHtml += '</div>';
              studentHtml += '</div>';
              studentHtml += '<div class="row-fluid"><div class="span2">&nbsp</div></div>';
              studentHtml += '<div id="courseDetails"></div>';
              studentHtml += '<div class="row-fluid"><div class="span2">&nbsp</div></div>';
              studentHtml += '<div class="row-fluid"><div class="span2"><button class="btn-info" onclick="restoreStudentList()"> Show student list</button></div></div>';


              $('#StuffGoesHere').html(studentHtml);
              console.log(data);
              var coursejson = { QueryString : "ContactCoursesAuthIDSP" , Params : {Contact : [Code]}};
              $.ajax({
        				url: './',
        				type: 'post',
        				data: JSON.stringify(coursejson),
        				dataType: 'json',
        				contentType: 'application/json; charset=utf-8',
        				success: function( coursedata ) {
                  var CourseOrCourses = ' course';
                  if (coursedata.length > 1) CourseOrCourses = ' courses';
                  var StartDate = new Date(coursedata[0].Date);
                  console.log(substr(0,10,coursedata[0].Date));
                  var courseTable = '<div class=row-fluid><div class="span2">' + data[0].FirstName + ' is studying ' + coursedata.length + CourseOrCourses + '.</div></div>';
                  //$('#courseDetails').append(coursedata[0].Invoice_Number + '');
                  courseTable += '<div class="tabs-holder"><table><tr><th>Started</th><th>Subject</th><th>Tutor</th></tr>';
                  $.each(coursedata, function(key, courserow){
                    courseTable += '<tr><td>' + substr(0,10,courserow.Date) + '</td><td>' + courserow.Subject_Name + '</td><td>' + courserow.Name + '</td></tr>';
                  });
                  courseTable += '</table></div>';
                  $('#courseDetails').html(courseTable);
                }
              });
            }
          });
        }
        	$(document).ready( function(){

        		$("#header").load("header.html");
        		var postjson = { QueryString : "InvoiceCustomerContactsAuthSP" , Params : {}};
			$.ajax({
				url: './',
				type: 'post',
				data: JSON.stringify(postjson),
				dataType: 'json',
				contentType: 'application/json; charset=utf-8',
				success: function( data ) {
				//alert(JSON.stringify(data));
        var items = data.length;
        var welcomeHtml = '<h2>Welcome ' + data[0].AuthName + "</h2><h3>A total of " + items + " students. <button id='ShowHide' class='btn-default' onclick='showList()'>Show/hide</button></h3>";
        $('#WelcomeMessage').html(welcomeHtml);
        console.log(welcomeHtml);
				tableHtml = "<div class='tabs-holder'><table id='StudentList'><tr><th>Name</th><th>Contact</th><th>Select</th></tr>";
				$.each(data, function(key, datarow) {
					tableHtml += '<tr><td>' + datarow.FirstName + ' ' + datarow.LastName + '</td><td>' + datarow.Code + '</td><td><input type="radio" name="SelectStudent" id="SelectStudent" value="' + datarow.Code + '" onclick="showStudent(' + datarow.Code + ')"></td></tr>';
				});
				tableHtml += "</table></div>";
				// please check logs in browser console
				console.log(tableHtml);
				$('#StuffGoesHere').html(tableHtml);
				}
			});
        	});
        </script>
    </head>
    <body>
      <div id="header"></div>
    <div id="WelcomeMessage" class="paper-white"></div>
    <div id="StuffGoesHere" style="display:none"></div>
    </body>
</html>
